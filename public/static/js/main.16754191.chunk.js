(this["webpackJsonpweb-chat-ui"]=this["webpackJsonpweb-chat-ui"]||[]).push([[0],{27:function(t,e,n){t.exports=n(59)},54:function(t,e,n){},55:function(t,e,n){},56:function(t,e,n){},57:function(t,e,n){},58:function(t,e,n){},59:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n.n(a),r=n(9),i=n(5),s=n(25),u=n(7),o=n(1),l=n(2),d=n.n(l),f=window.location,S=f.protocol,C=f.hostname,E=f.port,h="".concat(S,"//").concat(C,":").concat(E,"/api"),T="wss://".concat(C,":").concat(E),m=function(){return localStorage.getItem("user_token")},_=function(){var t=m();return t?{Authorization:"Bearer ".concat(t)}:{}},I=function(t){return localStorage.setItem("user_token",t),{type:"SET_USER_TOKEN",token:t}},O={user:null,token:localStorage.getItem("user_token"),initialized:!1,isProcessing:!1},p=n(6),N=function(t){return{type:"SET_ACTIVE_CHAT",chat:t}},A={chats:[],activeChat:null,initialized:!1,isProcessing:!1},v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"CHAT_PROCESSING_STARTED":return Object(o.a)({},t,{isProcessing:!0});case"CHAT_PROCESSING_FINISHED":return Object(o.a)({},t,{isProcessing:!1});case"CHAT_INITIALIZED":return Object(o.a)({},t,{initialized:!0});case"ACTIVE_CHAT_INITIALIZED":return Object(o.a)({},t,{activeChat:Object(o.a)({},t.activeChat,{initialized:!0})});case"SET_CHAT_LIST":return Object(o.a)({},t,{chats:e.chats});case"ADD_CHAT_TO_LIST":var n=e.chat;return Object(o.a)({},t,{chats:[].concat(Object(p.a)(t.chats),[n])});case"SET_ACTIVE_CHAT":return Object(o.a)({},t,{activeChat:Object(o.a)({},e.chat,{messages:[],invitationList:[]})});case"SET_ACTIVE_CHAT_MESSAGES":return Object(o.a)({},t,{activeChat:Object(o.a)({},t.activeChat,{messages:Object(p.a)(e.messages)})});case"ADD_MESSAGE_TO_ACTIVE_CHAT":return Object(o.a)({},t,{activeChat:Object(o.a)({},t.activeChat,{messages:[].concat(Object(p.a)(t.activeChat.messages),[e.message])})});case"UPDATE_CHAT_IN_LIST":var a=e.chat,c=t.activeChat&&t.activeChat.id===a.id?Object(o.a)({},t.activeChat,{},a):t.activeChat;return Object(o.a)({},t,{chats:t.chats.map((function(t){return t.id===a.id&&Object.assign(t,a),t})),activeChat:c});case"REMOVE_CHAT_FROM_LIST":var r=e.chatId,i=t.activeChat&&t.activeChat.id===r?null:t.activeChat;return Object(o.a)({},t,{chats:t.chats.filter((function(t){return t.id!==r})),activeChat:i});default:return t}},b={initialized:!1,isProcessing:!1,userContacts:[],availableContacts:[]},g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"CONTACTS_INITIALIZED":return Object(o.a)({},t,{initialized:!0});case"CONTACTS_PROCESSING_STARTED":return Object(o.a)({},t,{isProcessing:!0});case"CONTACTS_PROCESSING_FINISHED":return Object(o.a)({},t,{isProcessing:!1});case"ADD_CONTACT_TO_LIST":return Object(o.a)({},t,{userContacts:[].concat(Object(p.a)(t.userContacts),[e.userId])});case"REMOVE_CONTACTS_FROM_LIST":var n=t.userContacts.filter((function(t){return t!==e.userId}));return Object(o.a)({},t,{userContacts:n});case"ADD_USER_TO_AVAILABLE":return Object(o.a)({},t,{availableContacts:[].concat(Object(p.a)(t.availableContacts),[e.user])});case"SET_CONTACTSET_ALL_AVAILABLE_CONTACTSS_LIST":return Object(o.a)({},t,{availableContacts:Object(p.a)(e.contacts)});case"SET_CONTACTS_LIST":return Object(o.a)({},t,{userContacts:Object(p.a)(e.userIds)});default:return t}},y=Object(u.c)({user:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"USER_PROCESSING_STARTED":return Object(o.a)({},t,{isProcessing:!0});case"USER_PROCESSING_FINISHED":return Object(o.a)({},t,{isProcessing:!1});case"USER_INITIALIZED":return Object(o.a)({},t,{initialized:!0});case"SET_USER_TOKEN":var n=e.token;return Object(o.a)({},t,{token:n});case"SET_USER_PROFILE":var a=e.user;return Object(o.a)({},t,{user:a});default:return t}},chats:v,contacts:g}),j=n(26),R=(n(54),n(3)),D=(n(55),Object(i.b)((function(t){return{user:t.user}}),(function(t){return{signIn:function(e,n){return t(function(t,e){return function(n,a,c){n({type:"USER_PROCESSING_STARTED"});return d.a.post("".concat(c,"/users/login"),JSON.stringify({login:t,password:e}),{mode:"no-cors",headers:{"content-type":"application/json"}}).then((function(t){var e=t.data;window.localStorage.setItem("user_token",e),n(I(e))})).finally((function(){return n({type:"USER_PROCESSING_FINISHED"})}))}}(e,n))},signUp:function(e,n){return t(function(t,e){return function(n,a,c){n({type:"USER_PROCESSING_STARTED"});return d.a.post("".concat(c,"/users/register"),JSON.stringify({login:t,password:e}),{mode:"no-cors",headers:{"content-type":"application/json"}}).then((function(t){var e=t.data;n(I(e))})).finally((function(){return n({type:"USER_PROCESSING_FINISHED"})}))}}(e,n))}}}))((function(t){var e=t.user,n=t.signIn,r=t.signUp,i=Object(a.useState)(1),s=Object(R.a)(i,2),u=s[0],o=s[1],l=Object(a.useState)(""),d=Object(R.a)(l,2),f=d[0],S=d[1],C=Object(a.useState)(""),E=Object(R.a)(C,2),h=E[0],T=E[1],m=Object(a.useState)(""),_=Object(R.a)(m,2),I=_[0],O=_[1],p=Object(a.useState)(""),N=Object(R.a)(p,2),A=N[0],v=N[1],b=function(){O(""),v("")},g=function(t){return function(e){return t(e.target.value)}};return c.a.createElement("div",{className:"auth-form-container"},c.a.createElement("h3",null,"Web chat application"),c.a.createElement("form",{className:"auth-form",onSubmit:function(t){return t.preventDefault()}},c.a.createElement("input",{type:"text",placeholder:"login",value:f,disabled:e.isProcessing,onChange:g(S)}),c.a.createElement("input",{type:"password",placeholder:"password",value:h,disabled:e.isProcessing,onChange:g(T)}),c.a.createElement("div",{className:"auth-form-success"},A),c.a.createElement("div",{className:"auth-form-error"},I),c.a.createElement("div",{className:"auth-form-declaimer"},0===u?c.a.createElement("p",null,"Sign in to continue, don't have account ",c.a.createElement("b",{onClick:o.bind(null,1)},"sign up")):c.a.createElement("p",null,"Already registered, use your account ",c.a.createElement("b",{onClick:o.bind(null,0)},"sign in"))),0===u?c.a.createElement("button",{disabled:e.isProcessing||!f||!h,onClick:function(){b(),n(f,h).catch((function(t){t.response&&t.response.status<500?O("Invalid login or password"):O("server error")}))}},"Sign in"):c.a.createElement("button",{disabled:e.isProcessing||!f||!h,onClick:function(){b(),r(f,h).then((function(){S(""),T(""),o(0),v("User created, now you can sign in")})).catch((function(t){console.log(t.response),t.response&&409===t.response.status?O("User with this name already exists"):O("server error")}))}},"Sign up")))}))),P=(n(56),Object(i.b)((function(t){return{chatState:t.chats,contactsState:t.contacts,userState:t.user}}),(function(t){return{markChatInitialized:function(){return t({type:"CHAT_INITIALIZED"})},setChatList:function(){return t((function(t,e,n){t({type:"CHAT_PROCESSING_STARTED"});var a={headers:_()};return d.a.get("".concat(n,"/chats"),a).then((function(e){return t({type:"SET_CHAT_LIST",chats:e.data}),e.data})).finally((function(){return t({type:"CHAT_PROCESSING_FINISHED"})}))}))},selectChat:function(e){return t(N(e))},inviteToChat:function(e,n){return t(function(t,e){return function(n,a,c){n({type:"CHAT_PROCESSING_STARTED"});var r={headers:Object(o.a)({},_(),{"content-type":"application/json"})},i=JSON.stringify({participantIds:t,name:e});return d.a.post("".concat(c,"/chats"),i,r).then((function(t){return n(N(t.data)),t.data})).finally((function(){return n({type:"CHAT_PROCESSING_FINISHED"})}))}}(e,n))},markContactsInitialized:function(){return t({type:"CONTACTS_INITIALIZED"})},requestAvailableContacts:function(){return t((function(t,e,n){t({type:"CONTACTS_PROCESSING_STARTED"});var a={headers:_()};return d.a.get("".concat(n,"/contacts/all"),a).then((function(e){return t({type:"SET_CONTACTSET_ALL_AVAILABLE_CONTACTSS_LIST",contacts:e.data}),e.data})).finally((function(){return t({type:"CONTACTS_PROCESSING_FINISHED"})}))}))},requestContactList:function(){return t((function(t,e,n){t({type:"CONTACTS_PROCESSING_STARTED"});var a={headers:_()};return d.a.get("".concat(n,"/contacts"),a).then((function(e){return t({type:"SET_CONTACTS_LIST",userIds:e.data}),e.data})).finally((function(){return t({type:"CONTACTS_PROCESSING_FINISHED"})}))}))},addToContacts:function(e){return t(function(t){return function(e,n,a){e({type:"CONTACTS_PROCESSING_STARTED"});var c={headers:_()};return d.a.post("".concat(a,"/contacts/").concat(t),"",c).then((function(n){return e(function(t){return{type:"ADD_CONTACT_TO_LIST",userId:t}}(t)),n.data})).finally((function(){return e({type:"CONTACTS_PROCESSING_FINISHED"})}))}}(e))},deleteFromContacts:function(e){return t(function(t){return function(e,n,a){e({type:"CONTACTS_PROCESSING_STARTED"});var c={headers:_()};return d.a.delete("".concat(a,"/contacts/").concat(t),c).then((function(n){return e(function(t){return{type:"REMOVE_CONTACTS_FROM_LIST",userId:t}}(t)),n.data})).finally((function(){return e({type:"CONTACTS_PROCESSING_FINISHED"})}))}}(e))},deleteChat:function(e){return t(function(t){return function(e,n,a){e({type:"CHAT_PROCESSING_STARTED"});var c={headers:_()};return d.a.delete("".concat(a,"/chats/").concat(t),c).then((function(n){return e(function(t){return{type:"REMOVE_CHAT_FROM_LIST",chatId:t}}(t)),n.data})).finally((function(){return e({type:"CHAT_PROCESSING_FINISHED"})}))}}(e))}}}))((function(t){var e=t.chatState,n=t.contactsState,r=t.userState,i=t.markChatInitialized,s=t.setChatList,u=t.selectChat,o=t.markContactsInitialized,l=t.requestAvailableContacts,d=t.requestContactList,f=t.addToContacts,S=t.deleteFromContacts,C=t.inviteToChat,E=t.deleteChat,h=e.chats,T=n.availableContacts,m=n.userContacts,_=Object(a.useState)(""),I=Object(R.a)(_,2),O=I[0],p=I[1],N=Object(a.useState)(0),A=Object(R.a)(N,2),v=A[0],b=A[1],g=Object(a.useState)([]),y=Object(R.a)(g,2),j=y[0],D=y[1];e.initialized||e.isProcessing||(i(),s()),n.initialized||n.isProcessing||(o(),l(),d());var P=function(t){b(t),p(""),D([])},L=function(t){var e=function(t){return h.find((function(e){return 2===e.participantIds.length&&e.participantIds.includes(t)}))}(t);if(e)return P(0),void u(e);C([t,r.user.id]).then((function(t){P(0),u(t)}))},H=O?j:h,k=O?j:m.map((function(t){return T.find((function(e){return e.id===t}))}));return c.a.createElement("aside",{className:"chat-sidebar\n      ".concat(e.isProcessing||n.isProcessing?"disabled":"","\n    ")},c.a.createElement("input",{className:"chat-sidebar-filter",placeholder:"Search",value:O,onChange:function(t){var e=0===v?h:T,n=t.target.value;D(e.filter((function(t){return(0===v?t.name:t.login).toLowerCase().indexOf(n.toLowerCase())>-1}))),p(n)}}),c.a.createElement("i",{className:"fa fa-search search-icon","aria-hidden":"true"}),c.a.createElement("div",{className:"switches"},c.a.createElement("button",{onClick:function(){return P(0)},className:"".concat(0===v&&"active")},"Chats"),c.a.createElement("button",{onClick:function(){return P(1)},className:"".concat(1===v&&"active")},"Contacts")),0===v?c.a.createElement("div",{className:"chat-list"},H.map((function(t){return c.a.createElement("div",{onClick:function(){return u(t)},className:"chat-item",key:t.id},t.name,c.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true",onClick:function(){return E(t.id)}}))}))):c.a.createElement("div",{className:"chat-list"},k.map((function(t){return c.a.createElement("div",{className:"chat-item",key:t.id},t.login,O?m.includes(t.id)?c.a.createElement("span",null,c.a.createElement("i",{className:"fa fa-commenting","aria-hidden":"true",onClick:function(){return L(t.id)}}),c.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true",onClick:function(){return S(t.id)}})):c.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true",onClick:function(){return f(t.id)}}):c.a.createElement("span",null,c.a.createElement("i",{className:"fa fa-commenting","aria-hidden":"true",onClick:function(){return L(t.id)}}),c.a.createElement("i",{className:"fa fa-trash-o","aria-hidden":"true",onClick:function(){return S(t.id)}})))}))))}))),L=(n(57),Object(i.b)((function(t){return{chatState:t.chats,userState:t.user,contactsState:t.contacts}}),(function(t){return{sendMessage:function(e,n){return t(function(t,e){return function(n,a,c){var r={headers:Object(o.a)({},_(),{"content-type":"application/json"})},i=JSON.stringify({text:e});return d.a.post("".concat(c,"/chats/").concat(t,"/messages"),i,r)}}(e,n))},setMessages:function(e){return t(function(t){return function(e,n,a){var c={headers:_()};return d.a.get("".concat(a,"/chats/").concat(t,"/messages"),c).then((function(t){return e({type:"SET_ACTIVE_CHAT_MESSAGES",messages:t.data}),t.data}))}}(e))},initializeChat:function(){return t({type:"ACTIVE_CHAT_INITIALIZED"})},inviteUserToChat:function(e,n){return t(function(t,e){return function(n,a,c){n({type:"CHAT_PROCESSING_STARTED"});var r={headers:Object(o.a)({},_(),{"content-type":"application/json"})},i=JSON.stringify({userId:e});return d.a.post("".concat(c,"/chats/").concat(t,"/invite"),i,r).then((function(t){return t.data})).finally((function(){return n({type:"CHAT_PROCESSING_FINISHED"})}))}}(e,n))},updateChat:function(e){return t(function(t){return function(e,n,a){e({type:"CHAT_PROCESSING_STARTED"});var c={headers:_()};return d.a.get("".concat(a,"/chats/").concat(t),c).then((function(t){var n=t.data;return e(function(t){return{type:"UPDATE_CHAT_IN_LIST",chat:t}}(n)),n})).finally((function(){return e({type:"CHAT_PROCESSING_FINISHED"})}))}}(e))}}}))((function(t){var e=t.chatState,n=t.userState,r=t.contactsState,i=t.sendMessage,s=t.setMessages,u=t.initializeChat,o=t.inviteUserToChat,l=t.updateChat,d=e.activeChat;d&&!d.initialized&&(u(),s(d.id));var f=Object(a.useState)(""),S=Object(R.a)(f,2),C=S[0],E=S[1],h=Object(a.useState)(!1),T=Object(R.a)(h,2),m=T[0],_=T[1],I=Object(a.useState)(""),O=Object(R.a)(I,2),p=O[0],N=O[1],A=function(){d&&C.trim()&&i(d.id,C).then((function(){return E("")}))},v=c.a.createRef();setTimeout((function(){v.current&&v.current.scroll(0,window.scrollY+window.innerHeight)}),25);var b,g=function(){m&&N(""),_(!m)},y=[];return d&&(y=r.availableContacts.filter((function(t){var e=d.participantIds&&d.participantIds.includes(t.id),n=r.userContacts.includes(t.id);return!e&&n})).filter((function(t){return!p||t.login.toLowerCase().indexOf(p.toLocaleLowerCase())>-1}))),c.a.createElement("main",{className:"active-chat ".concat(e.isProcessing?"disabled":"")},c.a.createElement("div",{className:"active-chat-header"},c.a.createElement("h3",{className:"name"},d&&d.name),d&&c.a.createElement("div",{className:"pane"},c.a.createElement("i",{onClick:g,className:"fa fa-plus","aria-hidden":"true"}),m&&c.a.createElement("div",{className:"pane-list ".concat(m?"active":"")},c.a.createElement("input",{type:"text",placeholder:"filter",value:p,onChange:function(t){return N(t.target.value)}}),y.map((function(t){return c.a.createElement("div",{className:"pane-item",onClick:function(){return e=t.id,void o(d.id,e).then((function(){d.participantIds.push(e),N(""),g(),l(d.id)}));var e}},t.login)}))))),c.a.createElement("div",{className:"active-chat-messages",ref:v},d&&d.messages&&d.messages.map((function(t){return c.a.createElement("div",{key:t.id,className:"message\n              ".concat(t.senderId===n.user.id?"righty":"lefty")},c.a.createElement("div",{className:"bubble"},t.text))}))),c.a.createElement("input",{className:"send-message-input",value:C,onChange:(b=E,function(t){return b(t.target.value)}),onKeyPress:function(t){"Enter"===t.key&&A()}}),c.a.createElement("i",{onClick:A,className:"fa fa-paper-plane-o send-message-button","aria-hidden":"true"}))}))),H=(n(58),Object(i.b)((function(t){return{userState:t.user}}))((function(t){var e=t.dispatch,n=t.userState.user;return c.a.createElement("header",{className:"user-status-header"},c.a.createElement("i",{className:"fa fa-user-circle-o","aria-hidden":"true"}),n&&n.login,c.a.createElement("i",{className:"fa fa-sign-out","aria-hidden":"true",onClick:function(){return e(I(""))}}))}))),k="MESSAGE_CREATED",G="CHAT_CREATED",w="USER_CREATED",U=Object(i.b)((function(t){return{user:t.user}}))((function(t){var e=t.dispatch,n=t.user;return!n.token?c.a.createElement(D,null):(n.initialized||n.isProcessing||(e({type:"USER_INITIALIZED"}),e((function(t,e,n){t({type:"USER_PROCESSING_STARTED"});var a={headers:_()};return d.a.get("".concat(n,"/users/profile"),a).then((function(t){return t.data})).then((function(e){return t(function(t){return{type:"SET_USER_PROFILE",user:t}}(e))})).finally((function(){return t({type:"USER_PROCESSING_FINISHED"})}))})).catch((function(t){})),function(t){try{new WebSocket("".concat(T,"?token=").concat(m())).onmessage=function(e){var n=JSON.parse(e.data);switch(n.type){case k:return t(function(t){return{type:"ADD_MESSAGE_TO_ACTIVE_CHAT",message:t}}(n.data));case w:return t({type:"ADD_USER_TO_AVAILABLE",user:n.data});case G:return t({type:"ADD_CHAT_TO_LIST",chat:n.data});default:return}}}catch(e){console.log("failed to connect over ws")}}(e)),c.a.createElement("div",{className:"App"},c.a.createElement(H,null),c.a.createElement("div",{className:"component-container"},c.a.createElement(P,null),c.a.createElement(L,null))))})),F=Object(u.d)(y,Object(u.a)(j.a.withExtraArgument(h),Object(s.createLogger)()));Object(r.render)(c.a.createElement(i.a,{store:F},c.a.createElement(U,null)),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.16754191.chunk.js.map